<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Cliquer pour entrer...</title>
<style>
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial,Helvetica;background:#000;color:#fff}
  .center{height:100%;display:flex;align-items:center;justify-content:center;flex-direction:column}
  .prompt{font-size:28px;letter-spacing:1px;opacity:0.95;cursor:pointer;user-select:none}
  .small{font-size:13px;color:#bbb;margin-top:10px}
  /* full screen scare */
  #scareWrap{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:#000;z-index:9999;overflow:hidden}
  #scareImg{position: fixed; inset: 0; width: 100vw; height: 100vh; object-fit: cover; filter:contrast(1.05) saturate(1.05); z-index:9999;}
  /* controlled 'flash' overlays (not strobe) */
  .overlay {position:absolute;inset:0;pointer-events:none;mix-blend-mode:normal;opacity:0}
  .redPulse {background:rgba(170,0,0,0.75);animation:rp 0.42s linear 1 forwards}
  .whitePulse {background:rgba(255,255,255,0.85);animation:wp 0.35s linear 1 forwards} /* plus intense initial */
  @keyframes rp {0%{opacity:0}20%{opacity:0.9}60%{opacity:0.25}100%{opacity:0}}
  @keyframes wp {0%{opacity:0}30%{opacity:0.95}100%{opacity:0}}
  /* subtle shake */
  .shake {animation:shakeA 0.4s ease-in-out 1}
  @keyframes shakeA {0%{transform:translateY(0)}30%{transform:translateY(-8px)}60%{transform:translateY(6px)}100%{transform:translateY(0)}}
</style>
</head>
<body>
  <div class="center" id="promptArea">
    <div class="prompt" id="prompt">cliquer pour entrer...</div>
    <div class="small">Public averti uniquement — ne pas cibler des personnes vulnérables.</div>
  </div>

  <div id="scareWrap" role="dialog" aria-hidden="true">
    <img id="scareImg" alt="scare" src="" />
    <div id="red" class="overlay" style="display:none"></div>
    <div id="white" class="overlay" style="display:none"></div>
  </div>

<script>
/* Config */
const gifUrl = "https://c.tenor.com/B7TsnDoMqb0AAAAd/tenor.gif"; 
const pulseSequence = [
  {type:'white', delay: 220},
  {type:'red', delay: 140},
  {type:'white', delay: 180}
];
const totalShowMs = 1600; 

/* Elements */
const prompt = document.getElementById('prompt');
const promptArea = document.getElementById('promptArea');
const scareWrap = document.getElementById('scareWrap');
const scareImg = document.getElementById('scareImg');
const red = document.getElementById('red');
const white = document.getElementById('white');

/* Jump-scare au clic */
prompt.addEventListener('click', async () => {
  // demander le plein écran
  if(document.documentElement.requestFullscreen){
    document.documentElement.requestFullscreen().catch(()=>{});
  }

  // hide prompt
  promptArea.style.display = 'none';

  // flash initial intense
  white.style.display = 'block';
  white.classList.remove('whitePulse'); void white.offsetWidth;
  white.classList.add('whitePulse');
  setTimeout(()=> white.style.display = 'none', 400);

  // show image après court délai pour que flash soit visible
  setTimeout(()=>{
    scareImg.src = gifUrl;
    scareWrap.style.display = 'flex';
    scareImg.classList.add('shake');
  }, 150); // petit délai 150ms

  // start audio (synthesized)
  setTimeout(async ()=>{
    try { await playDistortedBurst(); } catch(e){ console.warn("audio error", e); }
  }, 150);

  // schedule pulses (controlled)
  let t = 150;
  for (let s of pulseSequence) {
    setTimeout(()=> triggerPulse(s.type), t);
    t += s.delay;
  }
});

/* Pulse function */
function triggerPulse(type){
  if (type === 'red') {
    red.style.display = 'block';
    red.classList.remove('redPulse'); void red.offsetWidth;
    red.classList.add('redPulse');
    setTimeout(()=> red.style.display = 'none', 520);
  } else if (type === 'white') {
    white.style.display = 'block';
    white.classList.remove('whitePulse'); void white.offsetWidth;
    white.classList.add('whitePulse');
    setTimeout(()=> white.style.display = 'none', 300);
  }
}

/* Synthesized 'distorted' burst sound */
async function playDistortedBurst(){
  const ctx = new (window.AudioContext || window.webkitAudioContext)();
  const now = ctx.currentTime;

  const bufferSize = ctx.sampleRate * 0.25; 
  const noiseBuffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
  const data = noiseBuffer.getChannelData(0);
  for (let i = 0; i < bufferSize; i++) {
    data[i] = (Math.random()*2 -1) * (1 - i / bufferSize) * 0.6;
  }
  const noise = ctx.createBufferSource();
  noise.buffer = noiseBuffer;
  const noiseGain = ctx.createGain();
  noiseGain.gain.setValueAtTime(0.0, now);
  noiseGain.gain.linearRampToValueAtTime(0.7, now + 0.02);
  noiseGain.gain.exponentialRampToValueAtTime(0.01, now + 0.22);

  const osc = ctx.createOscillator();
  osc.type = "sawtooth";
  osc.frequency.setValueAtTime(220, now);
  osc.frequency.exponentialRampToValueAtTime(1800, now + 0.18);
  const oscGain = ctx.createGain();
  oscGain.gain.setValueAtTime(0.0001, now);
  oscGain.gain.linearRampToValueAtTime(0.45, now + 0.02);
  oscGain.gain.exponentialRampToValueAtTime(0.01, now + 0.22);

  const dist = ctx.createWaveShaper();
  dist.curve = makeDistortionCurve(300);
  dist.oversample = '4x';

  const master = ctx.createGain();
  master.gain.value = 0.9;

  noise.connect(noiseGain).connect(dist).connect(master).connect(ctx.destination);
  osc.connect(oscGain).connect(dist).connect(master).connect(ctx.destination);

  noise.start(now);
  osc.start(now);
  noise.stop(now + 0.25);
  osc.stop(now + 0.25);

  function makeDistortionCurve(amount) {
    const k = typeof amount === 'number' ? amount : 50;
    const n_samples = 44100;
    const curve = new Float32Array(n_samples);
    const deg = Math.PI / 180;
    for (let i = 0; i < n_samples; ++i ) {
      const x = i * 2 / n_samples - 1;
      curve[i] = (3 + k) * x * 20 * deg / (Math.PI + k * Math.abs(x));
    }
    return curve;
  }
}
</script>
</body>
</html>
